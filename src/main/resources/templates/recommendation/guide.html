<!-- âœ… ì…ì–‘ ì¶”ì²œ í¼ (adopt_form.html) -->
<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<head>
<th:block layout:fragment="styles">
  <link rel="stylesheet" href="/css/adopt.css">
</th:block>

  <meta charset="UTF-8">
  <title>ìˆ¨ìˆ¨ì´ ì…ì–‘ ì¶”ì²œ</title>
<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
  <!-- âœ… JSëŠ” window.onload ë‚´ë¶€ë¡œ ì´ë™ -->
  <script>
  const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
    window.onload = function () {
      document.getElementById("submitBtn").addEventListener("click", () => {
        const form = document.getElementById("adoptForm");
        const formData = new FormData(form);
        const jsonData = {};
        formData.forEach((v, k) => jsonData[k] = v);

        const resultDiv = document.getElementById("result");
        const progress = document.getElementById("progress");

        resultDiv.style.display = "none";
        progress.style.display = "block";

        fetch("/recommendation/guide", {
          method: "POST",
          headers: {'Content-Type': 'application/json',
          [csrfHeader]: csrfToken },
          body: JSON.stringify(jsonData)
        })
        .then(res => res.json())
        .then(data => {
          console.log("ğŸ”¥ ì‹¤ì œ result êµ¬ì¡°:", data.result);
          progress.style.display = "none";
          resultDiv.style.display = "block";
        
          // âœ… resultê°€ ê°ì²´ë©´ ì†ì„± êº¼ë‚´ì„œ ì¶œë ¥
          if (data.result && typeof data.result === "object") {
            resultDiv.innerHTML = `
              <h4>ì¶”ì²œ ê²°ê³¼</h4>
              <p><strong>ì¶”ì²œ:</strong> ${data.result.ì¶”ì²œ}</p>
              <p><strong>ì„¤ëª…:</strong> ${data.result.ì„¤ëª…}</p>
              <p><strong>í˜„ì‹¤ì„±:</strong> ${data.result.í˜„ì‹¤ì„±}</p>
              <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ${data.result.ì£¼ì˜ì‚¬í•­}</p>
            `;
          } else {
            resultDiv.innerHTML = `<p style='color:red;'>ì¶”ì²œ ê²°ê³¼ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
          }
        })
        .catch(err => {
          progress.style.display = "none";
          resultDiv.innerHTML = `<p style='color:red;'>ì„œë²„ ì˜¤ë¥˜: ${err.message}</p>`;
          resultDiv.style.display = "block";
        });
      });
    };
  </script>
</head>

<body>
<div layout:fragment="content" class="container_main" style="max-width: 600px; margin: 30px auto;">
  <h2>ğŸ ìˆ¨ìˆ¨ì´ ì…ì–‘ ì¶”ì²œ ì„¤ë¬¸</h2>
  <form id="adoptForm">
    <label for="age">ë‚˜ì´:</label>
    <select name="age" id="age">
      <option>10ëŒ€ ì´í•˜</option>
      <option>20ëŒ€</option>
      <option>30ëŒ€</option>
      <option>40ëŒ€ ì´ìƒ</option>
    </select><br><br>

    <label for="experience">ë°˜ë ¤ë™ë¬¼ ê²½í—˜:</label>
    <select name="experience" id="experience">
      <option>ì—†ìŒ</option>
      <option>ìˆìŒ</option>
    </select><br><br>
    

    <label for="personality">ì„ í˜¸í•˜ëŠ” ë™ë¬¼ ì„±ê²©:</label>
    <select name="personality" id="personality">
      <option>ì¡°ìš©í•œ</option>
      <option>í™œë™ì ì¸</option>
      <option>ì‚¬êµì ì¸</option>
      <option>ë…ë¦½ì ì¸</option>
    </select><br><br>

    <label for="environment">ê±°ì£¼ í™˜ê²½:</label>
    <select name="environment" id="environment">
      <option>ì›ë£¸</option>
      <option>ì•„íŒŒíŠ¸</option>
      <option>ë‹¨ë…ì£¼íƒ</option>
      <option>ë§ˆë‹¹ ìˆëŠ” ì§‘</option>
    </select><br><br>

    <label for="condition">ìš”ì²­ì‚¬í•­:</label>
    <textarea name="condition" id="condition" rows="3" cols="40" placeholder="ì•Œë ˆë¥´ê¸°, ì–´ë¦° ìë…€ ìˆìŒ ë“±"></textarea><br><br>

    <button type="button" id="submitBtn" class="navbar-btn">ì…ì–‘ ì¶”ì²œ ë°›ê¸°</button>
  </form>

  <!-- âœ… ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ -->
  <div id="progress" style="margin-top: 20px; display: none;">
    <img src="/images/progress.gif" style="width: 40px;"> ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤...
  </div>

  <!-- âœ… ê²°ê³¼ ì¶œë ¥ -->
  <div id="result" style="margin-top: 20px;"></div>
</div>
</body>
</html>
